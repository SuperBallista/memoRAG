# memoRAG 개발 가이드

개발자를 위한 상세 가이드입니다.

## 🏗️ 프로젝트 구조

### 디렉토리 구조

```
memoRAG/
├── src/                    # 소스 코드
│   ├── core/              # 핵심 엔진
│   ├── services/          # 비즈니스 로직
│   ├── cli/               # CLI 인터페이스
│   └── utils/             # 유틸리티
├── tests/                 # 테스트
├── docs/                  # 문서
│   ├── dev/              # 개발자 문서
│   └── user/             # 사용자 문서
├── dist/                  # 빌드 결과
└── build/                 # 빌드 임시 파일
```

### 모듈 설명

#### src/core/

**parser.py** - 문서 파서
- `DocumentParser`: 다양한 문서 형식을 텍스트로 변환
- 지원 형식: PDF, DOCX, HWPX, PPTX, XLSX, TXT, MD
- 청크 분할 기능

**embedder.py** - 임베딩 엔진
- `EmbeddingEngine`: 텍스트를 벡터로 변환
- sentence-transformers 기반
- 배치 처리 지원

**vector_search.py** - 벡터 검색
- `VectorSearch`: ChromaDB 래퍼
- 코사인 유사도 검색
- 컬렉션 관리

#### src/services/

**indexing.py** - 인덱싱 서비스
- `IndexingService`: 폴더 스캔 및 인덱싱
- 진행률 표시
- 오류 처리

**query.py** - 쿼리 서비스
- `QueryService`: 자연어 검색 처리
- 결과 포맷팅
- 스니펫 생성

**management.py** - 관리 서비스
- `ManagementService`: 인덱스 관리
- 목록 조회
- 삭제 기능

#### src/cli/

**main.py** - CLI 진입점
- Click 기반 명령어
- 사용자 입력 처리
- Rich 출력

#### src/utils/

**config.py** - 설정 관리
- `Config`: YAML 설정 로드/저장
- 기본값 관리

**logger.py** - 로깅
- Rich 핸들러
- 파일 로깅

---

## 🔧 개발 환경 설정

### 1. 저장소 클론

```bash
git clone https://github.com/your-username/memorag.git
cd memorag
```

### 2. 가상환경 생성

```bash
python -m venv venv

# Windows
.\venv\Scripts\activate

# macOS/Linux
source venv/bin/activate
```

### 3. 의존성 설치

```bash
# CPU 버전 (권장)
install_cpu.bat

# 또는 수동
pip install -r requirements.txt
```

### 4. 개발 도구 설정

```bash
# 코드 포맷터
pip install black

# 린터
pip install flake8

# 타입 체커 (선택)
pip install mypy
```

---

## 💻 개발 워크플로우

### 기능 추가 예시: 새 파일 형식 지원

#### 1. 파서 함수 추가

```python
# src/core/parser.py

def _parse_new_format(self, file_path: Path) -> List[DocumentChunk]:
    """새 파일 형식 파싱"""
    try:
        import new_library
    except ImportError:
        raise ImportError("new_library required")
    
    chunks = []
    # 파싱 로직
    return chunks
```

#### 2. 지원 확장자 추가

```python
SUPPORTED_EXTENSIONS = {
    ".pdf", ".docx", ".hwpx", 
    ".pptx", ".xlsx", ".txt", ".md",
    ".new"  # 추가
}
```

#### 3. 분기 로직 추가

```python
elif extension == ".new":
    return self._parse_new_format(file_path)
```

#### 4. 테스트 작성

```python
# tests/test_parser.py

def test_new_format_parsing():
    parser = DocumentParser()
    chunks = parser.parse(Path("test.new"))
    assert len(chunks) > 0
```

#### 5. 문서 업데이트

- README.md 지원 형식에 추가
- 사용자 가이드 업데이트

---

## 🧪 테스트

### 유닛 테스트

```bash
# 전체 테스트
pytest tests/

# 특정 파일
pytest tests/test_parser.py

# Verbose 모드
pytest tests/ -v

# 커버리지
pytest tests/ --cov=src
```

### 통합 테스트

```bash
# 전체 워크플로우 테스트
python test_simple.py
```

### 수동 테스트

```bash
# CLI 테스트
python run.py index --folder test_documents
python run.py query "테스트"
python run.py list
```

---

## 🏗️ 빌드

### 개발용 빌드

```bash
# Python으로 직접 실행
python run.py --help
```

### 배포용 빌드

```bash
# exe 파일 생성
python build_exe.py

# 또는
build.bat

# 결과: dist/memorag.exe
```

### 빌드 테스트

```bash
# exe 실행 테스트
dist\memorag.exe version
dist\memorag.exe index --folder test_documents
dist\memorag.exe query "테스트"
```

---

## 📝 문서 작성

### 코드 문서화

모든 public 함수/클래스에 docstring:

```python
def parse(self, file_path: Path) -> List[DocumentChunk]:
    """
    파일을 파싱하여 청크 리스트로 반환
    
    Args:
        file_path: 파싱할 파일 경로
        
    Returns:
        DocumentChunk 리스트
        
    Raises:
        ValueError: 지원하지 않는 파일 형식
        FileNotFoundError: 파일이 존재하지 않음
    """
```

### 사용자 문서

사용자 관련 변경 시 다음 문서 업데이트:

- `docs/user/사용자_가이드.txt`
- `docs/user/명령어_치트시트.txt`
- `README.md`

---

## 🐛 디버깅

### 로깅 활성화

```bash
# Verbose 모드로 실행
python run.py --verbose index --folder test_documents

# 로그 파일 확인
cat logs/memorag.log
```

### 일반적인 문제

#### 문제: 임베딩 모델 로드 실패
```python
# 해결: 모델 캐시 삭제
rm -rf ~/.cache/huggingface/hub/models--*
```

#### 문제: ChromaDB 오류
```python
# 해결: DB 초기화
python run.py clean --yes
```

#### 문제: 파싱 실패
```python
# 해결: 로그 확인
logger.exception("Parsing failed")
```

---

## 🚀 릴리스

### 릴리스 준비

1. **버전 업데이트**
   ```python
   # src/__init__.py
   __version__ = "0.2.0"
   ```

2. **CHANGELOG 작성**
   ```markdown
   ## [0.2.0] - 2025-XX-XX
   ### Added
   - 새 기능
   ```

3. **테스트**
   ```bash
   pytest tests/
   python test_simple.py
   ```

4. **빌드**
   ```bash
   python build_exe.py
   ```

5. **Git 태그**
   ```bash
   git tag -a v0.2.0 -m "Release v0.2.0"
   git push origin v0.2.0
   ```

6. **GitHub Release 생성**
   - exe 파일 업로드
   - CHANGELOG 복사
   - 사용자 가이드 첨부

---

## 📚 참고 자료

### 사용 기술

- [sentence-transformers](https://www.sbert.net/)
- [ChromaDB](https://docs.trychroma.com/)
- [Click](https://click.palletsprojects.com/)
- [Rich](https://rich.readthedocs.io/)
- [PyInstaller](https://pyinstaller.org/)

### 관련 문서

- [아키텍처 문서](아키텍처.md)
- [향후 확장 계획](../향후_확장_계획.md)
- [배포 가이드](../배포_가이드.md)

---

## 🤝 커뮤니티

- **GitHub Discussions**: 질문, 아이디어 공유
- **Issues**: 버그 리포트, 기능 제안
- **Pull Requests**: 코드 기여

---

**Happy Coding! 🎉**

