# memoRAG 배포 가이드

## 🎁 exe 파일로 빌드하기

memoRAG를 **Python 설치 없이** 실행할 수 있는 단일 exe 파일로 만들 수 있습니다.

### 빌드 요구사항

- Python 3.9 이상 설치됨
- 가상환경 설정 완료
- PyInstaller 설치됨 (requirements.txt에 포함)

### 빌드 방법

#### 방법 1: 빌드 스크립트 사용 (추천)

```bash
# Windows
build.bat

# 또는 직접
python build_exe.py
```

#### 방법 2: PyInstaller 직접 사용

```bash
# 가상환경 활성화
.\venv\Scripts\activate

# spec 파일로 빌드
pyinstaller memoRAG.spec

# 또는 직접 명령어
pyinstaller --onefile --name memoRAG run.py
```

### 빌드 결과

```
dist/
└── memoRAG.exe    # 단일 실행 파일 (약 500~800MB)
```

**크기가 큰 이유**: 
- PyTorch (약 400MB)
- 임베딩 모델 지원 라이브러리
- 모든 의존성 포함

---

## 📦 배포 패키지 구성

### 개인 사용자용

```
memoRAG_v0.1.0/
├── memoRAG.exe              # 실행 파일
├── config.yaml.example     # 설정 예시
├── README.txt              # 간단 사용법
└── 샘플문서/
    ├── sample1.txt
    ├── sample2.txt
    └── sample3.txt
```

**README.txt** 내용:
```
memoRAG - 교사용 문서 검색 시스템

사용법:
1. 문서 인덱싱
   memoRAG.exe index --folder 문서폴더경로

2. 검색
   memoRAG.exe query "찾고싶은내용"

3. 인덱스 목록
   memoRAG.exe list

4. 도움말
   memoRAG.exe --help

지원 파일: PDF, DOCX, HWPX, PPTX, XLSX, TXT, MD

문의: [GitHub 이슈 트래커]
```

### 부서 공유용

```
memoRAG_부서용_v0.1.0/
├── memoRAG.exe
├── 설치가이드.pdf
├── 사용매뉴얼.pdf
└── 인덱스_공유_방법.txt
```

---

## 🚀 배포 시나리오

### 시나리오 1: 개인 교사에게 배포

1. **압축 파일 생성**
   ```bash
   # 필요한 파일만 포함
   dist/memoRAG.exe
   config.yaml.example
   README.txt
   ```

2. **전달 방법**
   - 학교 내부 네트워크
   - USB 드라이브
   - 이메일 (크기 주의)
   - 클라우드 링크 (Google Drive, Dropbox)

3. **사용자 시작**
   ```bash
   # 샘플로 테스트
   memoRAG.exe index --folder 샘플문서
   memoRAG.exe query "체육대회"
   ```

### 시나리오 2: 부서 단위 배포

1. **담당자가 인덱스 생성**
   ```bash
   memoRAG.exe index --folder ./교무부문서 --output 교무부_2025_10
   ```

2. **인덱스 파일 공유**
   - 생성된 `chroma/교무부_2025_10/` 폴더를 압축
   - 팀원들에게 메신저로 전달

3. **팀원이 사용**
   ```bash
   # 받은 인덱스를 chroma/ 폴더에 압축 해제
   memoRAG.exe query "공문" --index 교무부_2025_10
   ```

---

## 🔧 빌드 최적화

### 크기 줄이기

#### 1. 불필요한 의존성 제외

`memoRAG.spec` 파일 수정:
```python
excludes=[
    'matplotlib',
    'pandas',
    'scipy.spatial.transform',
    'numpy.distutils',
    'IPython',
    'jupyter',
]
```

#### 2. UPX 압축 사용

```python
# memoRAG.spec
exe = EXE(
    ...
    upx=True,  # 활성화
    ...
)
```

**참고**: UPX 다운로드 필요 (https://upx.github.io/)

#### 3. 가벼운 대안 고려

- **임베딩 모델**: 더 작은 모델로 교체
  - `multilingual-e5-small` (약 200MB)
  - `paraphrase-multilingual-MiniLM` (약 100MB)

---

## 🐛 문제 해결

### 문제 1: 빌드가 너무 느림

**원인**: PyTorch가 큼
**해결**: 
```bash
# CPU 전용 PyTorch 사용 (기본 적용됨)
pip uninstall torch
pip install torch --index-url https://download.pytorch.org/whl/cpu
```

**참고**: 프로젝트는 기본적으로 CPU 버전을 사용하도록 설정되어 있습니다.

### 문제 2: exe 실행 시 오류

**원인**: 숨겨진 import
**해결**: `memoRAG.spec`의 `hiddenimports`에 추가

### 문제 3: 크기가 너무 큼

**원인**: 모든 의존성 포함
**해결**: 
- excludes 항목 추가
- UPX 압축 사용
- 더 작은 모델 사용

### 문제 4: 모델 다운로드 실패

**원인**: exe는 모델 포함 안 함 (너무 큼)
**해결**: 첫 실행 시 자동 다운로드 (인터넷 필요)

---

## 📊 빌드 크기 비교

| 구성 | 크기 |
|------|------|
| 기본 빌드 (GPU PyTorch) | ~800MB |
| CPU 전용 PyTorch ⭐ | ~500MB |
| + UPX 압축 | ~400MB |
| + 작은 모델 (MiniLM) | ~350MB |

**참고**: 프로젝트는 기본적으로 CPU + MiniLM 모델을 사용합니다.

---

## 🌐 온라인 배포

### GitHub Release

1. **태그 생성**
   ```bash
   git tag -a v0.1.0 -m "First release"
   git push origin v0.1.0
   ```

2. **Release 생성**
   - GitHub > Releases > Create new release
   - `memoRAG_v0.1.0_windows.zip` 업로드

3. **다운로드 링크 공유**
   ```
   https://github.com/user/memoRAG/releases/download/v0.1.0/memoRAG.exe
   ```

### 자동 빌드 (GitHub Actions)

`.github/workflows/build.yml`:
```yaml
name: Build memoRAG

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      - run: pip install -r requirements.txt
      - run: python build_exe.py
      - uses: actions/upload-artifact@v2
        with:
          name: memoRAG
          path: dist/memoRAG.exe
```

---

## 📝 체크리스트

배포 전 확인사항:

- [ ] 빌드 성공
- [ ] exe 실행 테스트
- [ ] 샘플 문서로 검색 테스트
- [ ] 도움말 표시 확인
- [ ] 버전 정보 정확
- [ ] README/가이드 문서 포함
- [ ] 라이선스 파일 포함
- [ ] 압축 파일 생성
- [ ] 다운로드 링크 테스트

---

## 🎯 다음 단계

1. **설치 프로그램 만들기**
   - Inno Setup 사용
   - 자동 설치/제거
   - 시작 메뉴 바로가기

2. **자동 업데이트**
   - 버전 체크
   - 자동 다운로드

3. **디지털 서명**
   - Code Signing Certificate
   - Windows SmartScreen 통과

---

**현재 상태**: exe 빌드 설정 완료! 
`build.bat` 실행만 하면 배포 가능한 실행 파일이 생성됩니다! 🎉

