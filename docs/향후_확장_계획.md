# memoRAG 향후 확장 계획

## ✅ 현재 완성 (v0.1.0)

### 핵심 기능
- ✅ 문서 파싱: PDF, DOCX, HWPX, PPTX, XLSX, TXT, MD
- ✅ 임베딩: multilingual-e5-base (768차원)
- ✅ 벡터 검색: ChromaDB 기반
- ✅ CLI 명령어: index, query, list, clean
- ✅ 인덱스 파일 공유 기능
- ✅ 자연어 검색
- ✅ 원문 표시 (출처 포함)

### 테스트 완료
- ✅ 통합 테스트 통과
- ✅ 검색 정확도 0.9 이상
- ✅ 샘플 문서 포함

---

## 🔮 향후 확장 계획

### Phase 2: 추가 파일 형태 지원

#### ✅ MVP에 포함됨
- ✅ **PPTX** (PowerPoint) - `python-pptx`
- ✅ **XLSX** (Excel) - `openpyxl`

#### 우선순위 높음
- [ ] **HWP** (한글 2007 이전) - `olefile` + 구조 분석

#### 우선순위 중간
- [ ] **이미지 내 텍스트** (JPG, PNG) - `pytesseract` (OCR)
- [ ] **HTML** - `beautifulsoup4`
- [ ] **EPUB** (전자책) - `ebooklib`

#### 우선순위 낮음
- [ ] **압축 파일** (ZIP, RAR) - 자동 압축 해제 후 파싱
- [ ] **웹 페이지** - URL 입력 시 자동 크롤링

#### 구현 방법
```python
# src/core/parser.py 확장
class DocumentParser:
    SUPPORTED_EXTENSIONS = {
        # 기존
        ".pdf", ".docx", ".hwpx", ".txt", ".md",
        # 추가
        ".pptx", ".xlsx", ".hwp", ".html", ".epub"
    }
    
    def _parse_pptx(self, file_path: Path):
        """PowerPoint 파싱"""
        from pptx import Presentation
        # 슬라이드별 텍스트 추출
        
    def _parse_xlsx(self, file_path: Path):
        """Excel 파싱"""
        import pandas as pd
        # 시트별 데이터 추출
```

---

### Phase 2.5: 클라우드 문서 연동

#### 노션 API 연동
- [ ] **Notion Database 연동**
  - Notion API를 통해 데이터베이스 페이지 가져오기
  - 페이지 내용 자동 동기화
  - 수정사항 감지 및 재인덱싱

```python
# 구현 예시
from notion_client import Client

class NotionParser:
    def fetch_pages(self, database_id: str):
        """Notion 데이터베이스의 모든 페이지 가져오기"""
        notion = Client(auth=os.environ["NOTION_TOKEN"])
        pages = notion.databases.query(database_id=database_id)
        # 페이지 내용 파싱 및 인덱싱
```

#### 구글 드라이브 API 연동
- [ ] **Google Drive 개인 문서 연동**
  - Drive API를 통해 문서 자동 다운로드
  - Docs, Sheets, Slides 등 실시간 접근
  - 폴더 단위 동기화

```python
# 구현 예시
from googleapiclient.discovery import build

class GoogleDriveParser:
    def list_files(self, folder_id: str):
        """구글 드라이브 폴더의 파일 목록"""
        service = build('drive', 'v3', credentials=creds)
        results = service.files().list(
            q=f"'{folder_id}' in parents",
            fields="files(id, name, mimeType)"
        ).execute()
        # 파일 다운로드 및 인덱싱
```

#### 기타 클라우드 서비스
- [ ] **Dropbox**
- [ ] **OneDrive**
- [ ] **Confluence**
- [ ] **Slack (메시지 검색)**

**참고**: 이 기능들은 GUI 완성 후 우선순위에 따라 구현 예정

---

### Phase 3: GUI 개발 (우선순위 높음 ⭐)

#### 3.1 Tkinter 데스크톱 GUI (1차 목표)

**목표**: 간단하고 직관적인 데스크톱 앱

```python
# src/gui/main_window.py
import tkinter as tk
from tkinter import ttk, filedialog, messagebox

class memoRAGGUI:
    def __init__(self):
        self.window = tk.Tk()
        self.window.title("memoRAG - 교사용 문서 검색")
        self.window.geometry("900x700")
        
        # 탭 구성
        self.notebook = ttk.Notebook(self.window)
        
        # 탭 1: 검색
        self.search_tab = ttk.Frame(self.notebook)
        self.create_search_tab()
        
        # 탭 2: 인덱싱
        self.index_tab = ttk.Frame(self.notebook)
        self.create_index_tab()
        
        # 탭 3: 관리
        self.manage_tab = ttk.Frame(self.notebook)
        self.create_manage_tab()
        
        self.notebook.add(self.search_tab, text="🔍 검색")
        self.notebook.add(self.index_tab, text="📁 인덱싱")
        self.notebook.add(self.manage_tab, text="⚙️ 관리")
        
    def create_search_tab(self):
        # 검색창
        search_frame = ttk.Frame(self.search_tab)
        ttk.Label(search_frame, text="질문:").pack(side=tk.LEFT)
        self.search_entry = ttk.Entry(search_frame, width=60)
        self.search_entry.pack(side=tk.LEFT, padx=5)
        self.search_button = ttk.Button(
            search_frame, 
            text="검색", 
            command=self.on_search
        )
        self.search_button.pack(side=tk.LEFT)
        search_frame.pack(pady=10)
        
        # 결과 표시
        result_frame = ttk.Frame(self.search_tab)
        self.result_text = tk.Text(
            result_frame, 
            height=30, 
            wrap=tk.WORD,
            font=("맑은 고딕", 10)
        )
        scrollbar = ttk.Scrollbar(
            result_frame, 
            command=self.result_text.yview
        )
        self.result_text.config(yscrollcommand=scrollbar.set)
        self.result_text.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        result_frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
```

**UI 구성**:
```
┌─────────────────────────────────────────┐
│  memoRAG - 교사용 문서 검색               │
├─────────────────────────────────────────┤
│ [🔍 검색] [📁 인덱싱] [⚙️ 관리]         │
├─────────────────────────────────────────┤
│                                         │
│  질문: [___________________] [검색]    │
│                                         │
│  인덱스: [default ▼]                   │
│                                         │
├─────────────────────────────────────────┤
│  검색 결과:                             │
│                                         │
│  [1] sample1.txt (유사도: 0.925)        │
│      경로: test_documents/sample1.txt   │
│      내용: 체육대회 안내문...           │
│      [파일 열기]                        │
│                                         │
│  [2] sample2.txt (유사도: 0.889)        │
│      ...                                │
│                                         │
└─────────────────────────────────────────┘
```

#### 3.2 FastAPI + React WebUI (2차 목표)

**장점**: 
- 웹 브라우저에서 접근
- 팀원들과 공유 가능
- 모바일에서도 사용 가능

```python
# src/api/main.py
from fastapi import FastAPI, UploadFile
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="memoRAG API")

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.post("/api/search")
async def search(query: str, index: str = "default", top_k: int = 5):
    """검색 API"""
    # 검색 로직
    return {"results": [...]}

@app.post("/api/index")
async def create_index(files: list[UploadFile], index_name: str):
    """문서 업로드 및 인덱싱"""
    # 인덱싱 로직
    return {"status": "success"}
```

**React 프론트엔드**:
- Material-UI 또는 Ant Design
- 반응형 디자인
- 다크 모드 지원

---

### Phase 4: LLM 요약 답변 기능

#### 3.1 OpenAI API 연동 (간편)

**장점**: 빠른 구현, 고품질
**단점**: 비용 발생

```python
# src/services/llm_service.py
import openai

class LLMService:
    def __init__(self, api_key: str):
        openai.api_key = api_key
    
    def summarize_results(self, query: str, results: list) -> str:
        """검색 결과를 요약하여 답변 생성"""
        context = "\n\n".join([r.text for r in results[:3]])
        
        prompt = f"""
다음 문서들을 참고하여 질문에 간단히 답변해주세요.

문서 내용:
{context}

질문: {query}

답변 (2-3문장):
"""
        response = openai.ChatCompletion.create(
            model="gpt-4o-mini",  # 저렴한 모델
            messages=[{"role": "user", "content": prompt}],
            max_tokens=200
        )
        return response.choices[0].message.content
```

**CLI 사용법**:
```bash
# 기본: 원문 표시
python run.py query "체육대회 준비물"

# LLM 요약 답변
python run.py query "체육대회 준비물" --summarize

# API 키 설정
export OPENAI_API_KEY="sk-..."
```

#### 3.2 로컬 LLM 연동 (무료)

**장점**: 비용 없음, 프라이버시
**단점**: 느림, 품질 낮음, 리소스 필요

**옵션 1: Ollama**
```bash
# 설치
ollama pull llama3

# 통합
python run.py query "질문" --summarize --local
```

**옵션 2: HuggingFace Transformers**
```python
from transformers import pipeline

generator = pipeline(
    "text-generation",
    model="beomi/Llama-3-Open-Ko-8B"  # 한국어 모델
)
```

#### 3.3 하이브리드 출력

```bash
python run.py query "체육대회 준비물" --summarize
```

**출력 예시**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
AI 요약 답변
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

체육대회 준비물은 운동화, 모자, 물병, 간식입니다.
10월 15일 오전 9시에 학교 운동장에서 진행되며,
체육복 착용이 필수입니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
검색 결과 (원문)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] sample1.txt (유사도: 0.925)
    경로: test_documents/sample1.txt
    
    체육대회 안내문
    
    일시: 2025년 10월 15일 (수요일) 오전 9시
    장소: 학교 운동장
    
    준비물:
    - 운동화
    - 모자
    - 물병
    - 간식
    ...
```

---

---



### Phase 5: 고급 기능

#### 5.1 멀티모달 검색
- [ ] 이미지로 검색 (CLIP 모델)
- [ ] 음성 입력 (Whisper)

#### 5.2 고급 검색 기능
- [ ] 날짜 필터링
- [ ] 파일 타입 필터링
- [ ] 여러 인덱스 동시 검색
- [ ] 검색 히스토리

#### 5.3 협업 기능
- [ ] 인덱스 공유 서버
- [ ] 권한 관리
- [ ] 검색 결과 공유

---

## 📅 예상 일정

### ✅ 완료 (v0.1.0)
- Phase 1: 기본 CLI + 핵심 기능
- Phase 2-1: PPTX, XLSX 지원

### 단기 (1-2개월) ⭐ 우선순위 높음
- **Phase 3.1: Tkinter GUI** - 사용자 친화적인 데스크톱 앱

### 중기 (3-6개월)
- Phase 4: LLM 요약 답변 (OpenAI API)
- Phase 2-2: 추가 파일 형태 (HWP, 이미지 OCR)

### 장기 (6개월 이상)
- Phase 3.2: FastAPI WebUI
- Phase 2.5: 클라우드 문서 연동 (Notion, Google Drive)
- Phase 5: 고급 기능

---

## 💡 우선순위 결정 기준

1. **사용자 피드백**: 실제 교사들이 가장 많이 요청하는 기능
2. **구현 난이도**: 빠르게 가치를 제공할 수 있는 것
3. **비용 효율성**: 무료 또는 저렴한 솔루션 우선

---

## 🔧 기술 스택 변경 고려사항

### 더 빠른 임베딩
- [ ] ONNX Runtime으로 최적화
- [ ] GPU 가속 (CUDA)
- [ ] 더 작은 모델로 교체

### 더 나은 검색
- [ ] Hybrid Search (BM25 + Vector)
- [ ] Reranker 추가 (정확도 향상)

### 확장성
- [ ] PostgreSQL + pgvector (대규모)
- [ ] Elasticsearch (검색 고도화)

---

**현재 버전으로도 충분히 유용하게 사용 가능하며,**
**필요에 따라 위 기능들을 순차적으로 추가할 수 있습니다!**

